//==================== USER ===================
model User {
  username  String           @id @db.Char(8)
  name      String?          @db.VarChar(100)
  email     String?          @unique @db.VarChar(100)
  password  String           @db.VarChar(255)
  isActive  Boolean          @default(true) @map("is_active")
  createdAt DateTime         @map("created_at") @db.Timestamptz(0)
  createdBy String           @map("created_by") @db.Char(8)
  updatedAt DateTime?        @map("updated_at") @db.Timestamptz(0)
  updatedBy String?          @map("updated_by") @db.Char(8)
  roles     UserRole[]
  features  UserPermission[]

  @@map("users")
}

//==================== ROLE ===================
model Role {
  code      String           @id @db.VarChar(50) // VD: ADMIN, MANAGER
  name      String           @db.VarChar(100)
  isActive  Boolean          @default(true) @map("is_active")
  createdAt DateTime         @map("created_at") @db.Timestamptz(0)
  createdBy String           @map("created_by") @db.Char(8)
  updatedAt DateTime?        @map("updated_at") @db.Timestamptz(0)
  updatedBy String?          @map("updated_by") @db.Char(8)
  users     UserRole[]
  features  RolePermission[]

  @@map("roles")
}

//==================== USER ROLE ===================
model UserRole {
  user        User   @relation(fields: [username], references: [username])
  username    String @db.Char(8)
  role        Role   @relation(fields: [roleCode], references: [code])
  roleCode    String @map("role_code") @db.VarChar(50)
  sectionCode String @db.Char(4)

  @@id([username, roleCode, sectionCode])
  @@map("user_role")
}

//==================== FEATURE ===================
model Feature {
  code      String           @id @db.VarChar(100) // VD: "CATEGORY", "ASSET", "REPORT.SALES"
  name      String           @db.VarChar(150)
  isActive  Boolean          @default(true) @map("is_active")
  createdAt DateTime         @map("created_at") @db.Timestamptz(0)
  createdBy String           @map("created_by") @db.Char(8)
  updatedAt DateTime?        @map("updated_at") @db.Timestamptz(0)
  updatedBy String?          @map("updated_by") @db.Char(8)
  roles     RolePermission[]
  users     UserPermission[]

  @@map("features")
}

//==================== ROLE PERMISSIONS ===================
model RolePermission {
  role        Role      @relation(fields: [roleCode], references: [code])
  roleCode    String    @map("role_code") @db.VarChar(50)
  feature     Feature   @relation(fields: [featureCode], references: [code])
  featureCode String    @map("feature_code") @db.VarChar(100)
  action      Action
  decision    Decision // ALLOW hoặc DENY
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @map("created_at") @db.Timestamptz(0)
  createdBy   String    @map("created_by") @db.Char(8)
  updatedAt   DateTime? @map("updated_at") @db.Timestamptz(0)
  updatedBy   String?   @map("updated_by") @db.Char(8)

  @@id([roleCode, featureCode, action])
  @@map("role_permission")
}

//==================== USER PERMISSIONS ===================
model UserPermission {
  user        User      @relation(fields: [username], references: [username])
  username    String    @db.Char(8)
  feature     Feature   @relation(fields: [featureCode], references: [code])
  featureCode String    @map("feature_code") @db.VarChar(100)
  action      Action
  decision    Decision // ALLOW hoặc DENY
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @map("created_at") @db.Timestamptz(0)
  createdBy   String    @map("created_by") @db.Char(8)
  updatedAt   DateTime? @map("updated_at") @db.Timestamptz(0)
  updatedBy   String?   @map("updated_by") @db.Char(8)

  @@id([username, featureCode, action])
  @@map("user_permissions")
}
